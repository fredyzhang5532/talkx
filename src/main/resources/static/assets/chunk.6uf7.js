var K=Object.defineProperty,Q=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var B=(a,t,e)=>t in a?K(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,$=(a,t)=>{for(var e in t||(t={}))Y.call(t,e)&&B(a,e,t[e]);if(I)for(var e of I(t))Z.call(t,e)&&B(a,e,t[e]);return a},E=(a,t)=>Q(a,X(t));var x=(a,t,e)=>new Promise((_,f)=>{var k=r=>{try{i(e.next(r))}catch(p){f(p)}},y=r=>{try{i(e.throw(r))}catch(p){f(p)}},i=r=>r.done?_(r.value):Promise.resolve(r.value).then(k,y);i((e=e.apply(a,t)).next())});import{ao as ee,o as d,a as u,e as l,_ as se,h as te,g as M,j as oe,k as ae,l as ne,n as le,O as ce,p as ie,c as re,q as de,t as ue,R as _e,f as g,D as L,v,F as pe,x as ve,d as q,ap as fe,A as he,B as N}from"./bundle.0.0.2.js?v=0.9994225010119648";import{I as F}from"./chunk.6uf22.js";import{u as me}from"./chunk.6uf32.js";import{M as xe}from"./chunk.6uf33.js";const ge={version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 512 512","enable-background":"new 0 0 512 512","xml:space":"preserve"},ke=l("path",{d:`M296,136c0-22.002-17.998-40-40-40s-40,17.998-40,40s17.998,40,40,40S296,158.002,296,136z M296,376\r
	c0-22.002-17.998-40-40-40s-40,17.998-40,40s17.998,40,40,40S296,398.002,296,376z M296,256c0-22.002-17.998-40-40-40\r
	s-40,17.998-40,40s17.998,40,40,40S296,278.002,296,256z`},null,-1),ye=[ke],we=ee({name:"MdMore",render:function(t,e){return d(),u("svg",ge,ye)}});const Ce={class:"history tpage"},be={class:"top_bar flex_b"},Me=["onClick"],qe={class:"text"},De=["onClick"],ze={key:0,class:"list"},Se=["onClick"],Ie={key:0,class:"noData"},Be={key:1,class:"noMoreData"},$e={key:2,class:"loading"},Ee="history",Le={__name:"index",setup(a){const t=te(),e=M(!1),_=oe(),f=ae(),k=ne(),y=le(),i=ce({current:1,size:10}),r=y.appContext.config.globalProperties.$bus,{showToast:p,closeWatch:R,clearWatch:V}=ie(Ee),{listDom:A,scolllDom:P,wrapperH:T,scroll:D,addScrollFun:U}=me(),c=M([]),w=M(!1),C=re(()=>t.query.type),z=()=>x(this,null,function*(){if(e.value)return;e.value=!0,C.value==="sql"&&(i.friendId=2);const{current:s,pages:o,records:n,total:b}=yield fe(i);c.value.push(...n.map(m=>E($({},m),{open:!1}))),w.value=s>=o||c.value.length>=b,e.value=!1}),S=()=>{c.value.forEach(s=>s.open=!1)},W=()=>{e.value||w.value||(i.current++,z())};de(()=>x(this,null,function*(){U(W),i.size=Math.max(Math.floor(T.value/41*1.5),10),document.addEventListener("click",S),z()})),ue(()=>{V(),document.removeEventListener("click",S)});const j=()=>_.back(),H=()=>{const s={name:"dialogue",query:{type:"add"}};C.value==="sql"&&(s.name="sqlchat"),_.push(s)},O=s=>{c.value.forEach(o=>{o.open=s.id===o.id?!o.open:!1})};let h={};const G=s=>{k.getCurrUid===s.id?p("nodel"):(h=s,p("del"))},J=s=>{C.value==="sql"?_.push({name:"sqlchat",query:{id:s.id}}):(_.push({name:"dialogue",query:{id:s.id,fid:s.friendId}}),r.emit("friendChange"))};return R("del",s=>x(this,null,function*(){if(s&&h.id)try{yield _e(h.id),f.success("删除成功");const o=c.value.findIndex(n=>n.id==h.id);c.value[o]&&c.value.splice(o,1),h={}}catch(o){f.success("删除失败")}})),(s,o)=>(d(),u("div",Ce,[l("div",be,[l("div",{class:"flex_sx_center back hover_bg",tabindex:"0",onClick:j},o[1]||(o[1]=[l("span",{class:"iconfont icon-rollback",style:{"font-size":"20px"}},null,-1),l("span",{class:"text"},"返回",-1)])),l("div",{class:"add hover_light",tabindex:"0",onClick:H},[g(v(F),{size:"30"},{default:L(()=>[g(v(xe))]),_:1})])]),l("div",{class:"list_wrapper",onScrollPassive:o[0]||(o[0]=(...n)=>v(D)&&v(D)(...n)),ref_key:"listDom",ref:A},[l("div",{ref_key:"scolllDom",ref:P},[(d(!0),u(pe,null,ve(c.value,(n,b)=>(d(),u("div",{class:"item flex_b flex_sx_center",key:b,onClick:m=>J(n)},[l("div",qe,he(n.title),1),l("div",{class:"right hover_color",onClick:N(m=>O(n),["stop"])},[g(v(F),{size:"30"},{default:L(()=>[g(v(we))]),_:1}),n.open?(d(),u("div",ze,[l("div",{class:"fitem",onClick:N(m=>G(n),["stop"])},"删除",8,Se)])):q("",!0)],8,De)],8,Me))),128)),c.value.length?w.value?(d(),u("div",Be,"没有更多了")):q("",!0):(d(),u("div",Ie,"目前没有历史话题")),e.value&&c.value.length>i.size?(d(),u("div",$e," loading...... ")):q("",!0)],512)],544)]))}},Pe=se(Le,[["__scopeId","data-v-3e5f0ae7"]]);export{Pe as default};
